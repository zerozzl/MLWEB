
<style>
.sub-header {
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.msg-container {
	padding: 0px 5px;
}

.loading-container {
	padding-top: 50px;
	text-align: center;
}

#statistical-today-container {
	overflow: auto;
	margin-bottom: 10px;
	/* border: 1px solid #000; */
}

#statistical-today-container>.statistical-holder {
	float: left;
	margin-right: 50px;
	/* border:1px solid #000; */
}

#statistical-today-container>.statistical-holder>h4 {
	margin-bottom: 20px;
}

#current_visits_count {
	width: 350px;
	height: 180px;
}

#uv-count {
	width: 300px;
	height: 180px;
}

#uv-count .quantity {
	font-size: 25px;
	color: #333333;
}

#uv-count .unit {
	font-size: 12px;
	color: #777777;
	font-family: inherit;
	font-weight: bold;
}

#visitor-opinion-count {
	height: 180px;
}

#visitor-opinion-count .quantity {
	float: left;
	margin-top: -20px;
	margin-left: 20px;
	font-size: 150px;
}

#visitor-opinion-count .unit{
	float: left;
	margin-top: 105px;
	margin-left: 10px;
	font-size: 30px;
	color: #777777;
	font-weight: bold;
}

#visitor-opinion-container>table {
	display: none;
}
</style>

<script>
function init_dashboard() {
	load_dependent_js(new Array("../highcharts/4.2.6/highcharts.js",
			"../highcharts/4.2.6/highcharts-more.js",
    		"../highcharts/4.2.6/modules/solid-gauge.js"),
    		function(){
				load_uv_info();
				load_current_visits_count();
			}
	);
	load_visitor_opinion();
	$("#visitor-opinion-dialog-container").load("visitor_opinion_show.html");
}

function load_visitor_opinion() {
	$.ajax({
		traditional : true,
		type : "post",
		dataType : "json",
		cache : false,
		timeout : 10000,
		url : "findUnreadVisitorOpinions.action",
		success : function(data, textStatus) {
			var container = $("#visitor-opinion-container"), opinions = data.ajaxObj.opinions;
			if (opinions.length > 0) {
				container.find(".msg-container").remove();
				var table = container.find("table");
				table.show();
				for(var i = 0; i < opinions.length; i++) {
					var item = opinions[i], image = "";
					if(item.includePic == "1") {
						image = "<i class='icon icon-blue icon-image'></i>";
					}
					var tr = "<tr><td>" + (i+1) + "</td><td><a class='font-blod' uuid='" + item.DBID + "' onclick='show_visitor_opinion(this);'>" + item.title + "</a></td><td>" + image
							+ "</td><td>" + item.creationDateS + "</td><td><a visitorid='" + item.visitorId + "'>" + item.visitorId + "</a></td></tr>";
					table.append(tr);
				}
			} else {
				container.find(".msg-container").html("<p class='help-block'>暂无未读访客评价</p>");
			}
		},
		error : function(jqXHR, status, errorThrown) {
			$("#visitor-opinion-container").find(".msg-container").html(ERROR_MSG);
		}
	});
}

function load_uv_info() {
	$.ajax({
		traditional : true,
		type : "post",
		dataType : "json",
		cache : false,
		timeout : 10000,
		url : "getUVInfo.action",
		success : function(data, textStatus) {
			draw_uv_info(data.ajaxObj);
		},
		error : function(jqXHR, status, errorThrown) {
			$("#uv-count").html(ERROR_MSG);
		}
	});
}

function draw_uv_info(data) {
	$("#uv-count").highcharts({
		chart: {
            type: "solidgauge"
        },
        title: null,
        pane: {
            center: ["50%", "85%"],
            size: "160%",
            startAngle: -90,
            endAngle: 90,
            background: {
                backgroundColor: "#eeeeee",
                innerRadius: "60%",
                outerRadius: "100%",
                shape: "arc"
            }
        },
        tooltip: {
            enabled: false
        },
        plotOptions: {
            solidgauge: {
                dataLabels: {
                    y: 5,
                    borderWidth: 0,
                    useHTML: true
                }
            }
        },
        yAxis: {
            min: 0,
            max: data.uv,
            stops: [
                [1.0, "#428bca"] // red
            ],
            lineWidth: 0,
            minorTickInterval: null,
            tickPixelInterval: 400,
            tickWidth: 0,
            labels: {
            	enabled: false
            }
        },
        credits: {
            enabled: false
        },
        series: [{
            name: "访客数",
            data: [data.online],
            dataLabels: {
                format: "<div style='text-align:center;'><span class='quantity'>"
                		+ data.online + "/" + data.uv
                		+ "</span><br/><span class='unit'>在线人数/总访问量</span></div>"
            }
        }]
    });
}

function load_current_visits_count() {
	$.ajax({
		traditional : true,
		type : "post",
		dataType : "json",
		cache : false,
		timeout : 10000,
		url : "getCurrentVisitsCount.action",
		success : function(data, textStatus) {
			draw_current_visits_count(data.ajaxObj);
			$("#visitor-opinion-count").html("<div class='quantity'>"
					+ data.ajaxObj.vocount + "</div><div class='unit'>条</div>");
		},
		error : function(jqXHR, status, errorThrown) {
			$("#current_visits_count").html(ERROR_MSG);
			$("#visitor-opinion-count").html(ERROR_MSG);
		}
	});
}

function draw_current_visits_count(data) {
	$("#current_visits_count").highcharts({
        chart: {
            type: "column"
        },
        title: null,
        credits: {
            enabled: false
        },
        xAxis: {
            type: "category"
        },
        yAxis: {
        	title: null
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                dataLabels: {
                    enabled: true,
                    format: "{point.y:.0f}次"
                }
            }
        },

        tooltip: {
            headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
            pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.0f}次</b>'
        },

        series: [{
            name: "检测类型",
            colorByPoint: true,
            data: [{
                name: "行人检测",
                y: data.pdcount
            }, {
                name: "人脸检测",
                y: data.fdcount
            }, {
                name: "图像语义分割",
                y: data.sscount
            }]
        }]
	});
}

</script>

<h2 class="page-header">Dashboard</h2>

<!-- 本日访问情况 -->
<h3 class="sub-header font-blod">本日访问情况</h3>
<div id="statistical-today-container">
	<div class="statistical-holder">
		<h4>检测统计</h4>
		<div id="current_visits_count">
			<div class="loading-container">
				<img src="../images/sys/loading_l.gif" />
			</div>
		</div>
	</div>
	<div class="statistical-holder">
		<h4>访客数</h4>
		<div id="uv-count">
			<div class="loading-container">
				<img src="../images/sys/loading_l.gif" />
			</div>
		</div>
	</div>
	<div class="statistical-holder">
		<h4>访客意见</h4>
		<div id="visitor-opinion-count">
			<div class="loading-container">
				<img src="../images/sys/loading_l.gif" />
			</div>
		</div>
	</div>
</div>

<!-- 访客意见 -->
<h3 class="sub-header font-blod">访客意见</h3>
<div id="visitor-opinion-container" class="table-responsive">
	<div class="msg-container">
		<div class="loading-container">
			<img src="../images/sys/loading_l.gif" />
		</div>
	</div>
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th width="5%">序号</th>
				<th>标题</th>
				<th width="5%">图片</th>
				<th width="13%">提交日期</th>
				<th width="20%">访客ID</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</div>

<div id="visitor-opinion-dialog-container"></div>
