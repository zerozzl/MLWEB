<script src="../highcharts/4.2.6/highcharts.js"></script>
<script src="../highcharts/4.2.6/highcharts-more.js"></script>
<script src="../highcharts/4.2.6/modules/solid-gauge.js"></script>

<style>
img {
	margin-top: 50px;
}

.sub-header {
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.msg-container {
	padding: 0px 5px;
}

.loading-container {
	text-align: center;
}

.placeholders h4 {
  margin-bottom: 0;
}

.placeholder {
  margin-bottom: 10px;
}

#uv-chart {
	width: 300px;
	height: 180px;
	/* border:1px solid #000; */
}

#visitor-opinion-count {
	height: 180px;
	/* border:1px solid #000; */
}

#visitor-opinion-container>table {
	display: none;
}
</style>

<script>
function init_dashboard() {
	init_visitor_opinion();
	load_uv_info();
	$("#visitor-opinion-dialog-container").load("visitor_opinion_show.html");
}

function init_visitor_opinion() {
	$.ajax({
		traditional : true,
		type : "post",
		dataType : "json",
		cache : false,
		timeout : 10000,
		url : "findUnreadVisitorOpinions.action",
		success : function(data, textStatus) {
			var container = $("#visitor-opinion-container"), opinions = data.ajaxObj.opinions;
			if (opinions.length > 0) {
				container.find(".msg-container").remove();
				var table = container.find("table");
				table.show();
				for(var i = 0; i < opinions.length; i++) {
					var item = opinions[i], image = "";
					if(item.includePic == "1") {
						image = "<i class='icon icon-blue icon-image'></i>";
					}
					var tr = "<tr><td>" + (i+1) + "</td><td><a class='font-blod' uuid='" + item.DBID + "' onclick='show_visitor_opinion(this);'>" + item.title + "</a></td><td>" + image
							+ "</td><td>" + item.creationDateS + "</td><td><a visitorid='" + item.visitorId + "'>" + item.visitorId + "</a></td></tr>";
					table.append(tr);
				}
			} else {
				container.find(".msg-container").html("<p class='help-block'>暂无未读访客评价</p>");
			}
		},
		error : function(jqXHR, status, errorThrown) {
			$("#visitor-opinion-container").find(".msg-container").html(ERROR_MSG);
		}
	});
}

function load_uv_info() {
	$.ajax({
		traditional : true,
		type : "post",
		dataType : "json",
		cache : false,
		timeout : 10000,
		url : "getUVInfo.action",
		success : function(data, textStatus) {
			draw_uv_info(data.ajaxObj);
		},
		error : function(jqXHR, status, errorThrown) {
			$("#uv-chart").html(ERROR_MSG);
		}
	});
}

function draw_uv_info(data) {
	$("#uv-chart").highcharts({
		chart: {
            type: "solidgauge"
        },
        title: null,
        pane: {
            center: ["50%", "80%"],
            size: "160%",
            startAngle: -90,
            endAngle: 90,
            background: {
                backgroundColor: "#eeeeee",
                innerRadius: "60%",
                outerRadius: "100%",
                shape: "arc"
            }
        },
        tooltip: {
            enabled: false
        },
        plotOptions: {
            solidgauge: {
                dataLabels: {
                    y: 5,
                    borderWidth: 0,
                    useHTML: true
                }
            }
        },
        yAxis: {
            min: 0,
            max: data.uv,
            stops: [
                [1.0, "#428bca"] // red
            ],
            lineWidth: 0,
            minorTickInterval: null,
            tickPixelInterval: 400,
            tickWidth: 0,
            labels: {
            	enabled: false
            }
        },
        credits: {
            enabled: false
        },
        series: [{
            name: "访客数",
            data: [data.online],
            dataLabels: {
                format: "<div style='text-align:center'><span style='font-size:25px;color:#333333;'>"
                		+ data.online + "/" + data.uv
                		+ "</span><br/><span style='font-size:12px;color:#777777;'>在线人数/总访问量</span></div>"
            }
        }]
    });
}

</script>

<h2 class="page-header">Dashboard</h2>

<!-- 本日访问情况 -->
<h3 class="sub-header font-blod">本日访问情况</h3>
<div class="row placeholders">
	<div class="col-xs-6 col-sm-3 placeholder">
		<h4>访客数</h4>
		<div id="uv-chart"><img src="../images/sys/loading_l.gif" /></div>
	</div>
	<div class="col-xs-6 col-sm-3 placeholder">
		<h4>访客意见</h4>
		<div id="visitor-opinion-count">
			<div style="float:left;margin-top:5px;margin-left:10px;font-size:120px;">0</div>
			<div style="float:left;margin-top:100px;margin-left:10px;font-size:30px;color:#777;">条</div>
		</div>
	</div>
	<div class="col-xs-6 col-sm-3 placeholder">
		<h4>Label</h4>
		<img src="../images/sys/not_found_image.jpg">
		<span class="text-muted">Something else</span>
	</div>
	<div class="col-xs-6 col-sm-3 placeholder">
		<img src="../images/sys/not_found_image.jpg">
		<h4>Label</h4>
		<span class="text-muted">Something else</span>
	</div>
</div>

<!-- 访客意见 -->
<h3 class="sub-header font-blod">访客意见</h3>
<div id="visitor-opinion-container" class="table-responsive">
	<div class="msg-container">
		<div class="loading-container">
			<img src="../images/sys/loading_l.gif" />
		</div>
	</div>
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th width="5%">序号</th>
				<th>标题</th>
				<th width="5%">图片</th>
				<th width="13%">提交日期</th>
				<th width="20%">访客ID</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
</div>

<div id="visitor-opinion-dialog-container"></div>
